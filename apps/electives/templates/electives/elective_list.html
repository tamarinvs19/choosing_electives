{% extends "base.html" %}
{% load static %}
{% block head_title %}
  Elective list
{% endblock %}
{% block extra_styles %}
  <link rel="stylesheet" type="text/css" href="{% static 'electives/css/main_page.css' %}">
{% endblock %}
{% block body %}
  <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header">
      <h5 id="offcanvasRightLabel">Additional options</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Закрыть"></button>
    </div>
    <div class="offcanvas-body">
      <div class="row">
        <span>
          Open all thematics
        <label class="switch">
          <input type="checkbox" onchange="clickSwitch(this)">
          <span class="slider round"></span>
        </label>
        </span>
      </div>
			<hr>
      <div class="row">
				<div class="col-md-9">
					<input id="filterInput" class="form-control me-2" type="search" placeholder="Filter" aria-label="Filter">
				</div>
				<div class="col-md-3">
					<button class="btn btn-outline-success" type="submit" onclick="filterElectives()">Filter</button>
				</div>
      </div>
    </div>
  </div>
  <div class="switch-container">
    <button class="switch-button btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">
			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
				  <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
			</svg>
    </button>
  </div>
  <div class="accordion accordion-flush" id="accordionPanelsElective">
  {% for thematic, electives in elective_groups %}
		{% if electives|length > 0 %}
    {% include "electives/themetic_list.html" with thematic=thematic electives=electives student_id=student_id %}
		{% endif %}
  {% endfor %}
  </div>
  <script>
      function change_kind(electiveId, kindId) {
          $.post("{% url 'electives:change_kind' %}",
              {'kind_id': kindId, 'elective_id': electiveId, 'csrfmiddlewaretoken': csrftoken},
              function(data) {
                  $(`#statistic-${electiveId}-${kindId}`)[0].innerHTML = data['students_count'][true];
                  $(`#statistic-maybe-${electiveId}-${kindId}`)[0].innerHTML = data['students_count'][false];
                  if (data['move'] !== null && data['other_language_kind'] !== null) {
                      $(`#statistic-${electiveId}-${data['other_language_kind']}`)[0].innerHTML = data['other_kind_counts'][true];
                      $(`#statistic-maybe-${electiveId}-${data['other_language_kind']}`)[0].innerHTML = data['other_kind_counts'][false];
                      $(`#button-${data['other_short_name']}-${electiveId}`)[0].checked = false;
                  }
                  const counter = $(`#row-${electiveId}`)[0];
									counter.dataset.fall = data['fall_count'];
									counter.dataset.spring = data['spring_count'];
              });
      }

      function clickSwitch(input) {
          if (input.checked) {
              $('.accordion-collapse').addClass('show');
          } else {
              $('.accordion-collapse').removeClass('show');
          }
      }

			function sortColumn(columnName, thematicId, direction = 1) {
				if (columnName === 'title') {
					direction = -1;
				}
				const parent = $(`.thematic-${thematicId}`);
				const items = parent.children(`.row-${thematicId}`).sort(function(a, b) {
					let vA = a.dataset[columnName];
					let vB = b.dataset[columnName];
					return direction * ((vA > vB) ? -1 : (vA < vB) ? 1 : 0);
				});
				parent.append(items);
			}

			function filterElectives() {
          const filter = document.getElementById('filterInput').value.toLowerCase();
          const parents = $('.accordion-body');
          for (let parent of parents) {
              const items = $(parent).children('.elective-row');
              items.map(function(number, elective) {
                  const dataset = elective.dataset;
                  let include = dataset['title'].toLowerCase().includes(filter) || dataset['russianName'].toLowerCase().includes(filter) || dataset['englishName'].toLowerCase().includes(filter) || dataset['teachers'].toLowerCase().includes(filter);
                  if (include) {
                      $(elective).show();
                  } else {
                      $(elective).removeAttr("style").hide();
                  }
              });
          }
			}

  </script>
{% endblock %}
